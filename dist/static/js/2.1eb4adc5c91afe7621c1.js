webpackJsonp([2],{MewG:function(e,t){},niH5:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("VTQS"),a={data:function(){return{trackers:[],evoUsers:[],evoUser:"",projects:null,loginToken:"",passwordToken:"",currentTracker:{id:0,title:"",api_url:"",type:"redmine"},showTracker:!1,showUser:!1,showToken:!1,showAlert:!1,alertMessage:"",userSettings:{evo_in_name:"#redmine_name",evo_in_comment:"#comments",evo_out_name:"#comments",evo_out_comment:""}}},methods:{getTrackers:function(){var e=this;n.b.getTrackers().then(function(t){e.trackers=t.data.trackers}).catch(function(e){console.log(["getTasks error",e])})},getEvoUsers:function(){var e=this;n.b.getEvoUsers().then(function(t){e.evoUsers=t.data.users}).catch(function(e){console.log(["getEvoUsers error",e])})},showTrackerModal:function(){this.showTracker=!0},closeTrackerModal:function(){this.showTracker=!1},deleteTracker:function(e){var t=this;confirm("вы действительно хотите удалить трекер из списка?")&&n.b.deleteTracker(this.currentTracker).then(function(e){t.getTrackers(),t.showTracker=!1}).catch(function(e){console.log(["getToken error",e])})},saveTracker:function(){var e=this;n.b.saveTracker(this.currentTracker).then(function(t){e.getTrackers(),e.showTracker=!1}).catch(function(e){console.log(["getToken error",e])})},saveEvoUser:function(){var e=this;n.b.saveEvoUser(this.evoUser).then(function(t){e.getTrackers(),e.showUser=!1}).catch(function(e){console.log(["saveTrackerUser error",e])})},addTracker:function(e){this.currentTracker={id:0,title:"",api_url:"",type:e},this.showTrackerModal()},editTracker:function(e){this.currentTracker=e,this.showTrackerModal()},getSettings:function(){var e=this;n.b.getSettings().then(function(t){for(var r in t.data.data)e.userSettings[r]=t.data.data[r]}).catch(function(e){console.log(["getSettings error",e])})},saveSettings:function(){var e=this;if(""===this.userSettings.evo_in_name.trim()||""===this.userSettings.evo_out_name.trim())return this.alert('<span style="color: red;">Формулировка обязательна!</span>'),!1;n.b.saveSettings(this.userSettings).then(function(t){e.alert("Изменения сохранены!")}).catch(function(t){console.log(["saveSettings error",t]),e.alert("Ошибка:"+t)})},restoreSettings:function(){this.userSettings={evo_in_name:"#redmine_name",evo_in_comment:"#comments",evo_out_name:"#comments",evo_out_comment:""}},showTokenModal:function(e){this.loginToken="",this.passwordToken="",this.currentTracker=e,this.showToken=!0},showUserModal:function(e){"evo"===e.type&&(this.currentTracker=e,this.showUser=!0)},closeTokenModal:function(){this.showToken=!1},closeUserModal:function(){this.showUser=!1},getToken:function(){var e=this;n.b.getToken(this.currentTracker.id,this.loginToken,this.passwordToken).then(function(t){void 0!==t.data.external_token&&null!==t.data.external_token?(e.getTrackers(),"evo"===e.currentTracker.type&&e.getEvoUsers(),e.showToken=!1):e.alert("Ошибка авторизации")}).catch(function(e){console.log(["getToken error",e])})},alert:function(e){this.alertMessage=e,this.showAlert=!0}},components:{Modal:r("/o5o").default},mounted:function(){this.getTrackers(),this.getEvoUsers(),this.getSettings()}},o={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"md-layout md-gutter md-alignment-top-center center"},[r("div",{staticClass:"md-layout-item md-size-80"},[r("md-list",[r("md-list-item",[r("h3",[e._v("Трекеры")])]),e._v(" "),r("md-table",[r("md-table-row",[r("md-table-head"),e._v(" "),r("md-table-head",[e._v("Название")]),e._v(" "),r("md-table-head",[e._v("Url")]),e._v(" "),r("md-table-head",[e._v("Тип")]),e._v(" "),r("md-table-head",[e._v("Авторизация")]),e._v(" "),r("md-table-head",[e._v("Пользователь")])],1),e._v(" "),e._l(e.trackers,function(t){return r("md-table-row",{key:t.id},[r("md-table-head",[r("div",{staticClass:"edit-icon",on:{click:function(r){e.editTracker(t)}}},[r("font-awesome-icon",{attrs:{icon:"edit"}}),e._v(" "),r("md-tooltip",{attrs:{"md-direction":"top"}},[e._v("Редактировать")])],1)]),e._v(" "),r("md-table-head",[e._v(e._s(t.title))]),e._v(" "),r("md-table-head",[e._v(e._s(t.api_url))]),e._v(" "),r("md-table-head",[e._v(e._s(t.type))]),e._v(" "),r("md-table-head",[r("a",{staticClass:"simple-link",on:{click:function(r){e.showTokenModal(t)}}},[r("md-tooltip",{attrs:{"md-direction":"top"}},[e._v("Авторизация на трекере")]),e._v(" "),t.external_api_key?r("span",[e._v(e._s(t.external_api_key))]):e._e(),e._v(" "),t.external_api_key?e._e():r("span",[e._v("Авторизоваться")])],1)]),e._v(" "),r("md-table-head",[t.external_api_key&&"evo"===t.type?r("a",{staticClass:"simple-link",on:{click:function(r){e.showUserModal(t)}}},[t.external_user_id||"evo"!==t.type?e._e():r("span",[e._v("Указать пользователя")]),e._v(" "),t.external_user_id?r("span",[e._v(e._s(t.external_user_id))]):e._e()]):e._e(),e._v(" "),!t.external_user_id||"redmine"!==t.type&&"jira"!==t.type?e._e():r("span",[e._v(e._s(t.external_user_id))])])],1)})],2),e._v(" "),r("md-list-item",[r("md-button",{on:{click:function(t){e.addTracker("redmine")}}},[e._v("Добавить redmine")]),e._v(" "),r("md-button",{on:{click:function(t){e.addTracker("jira")}}},[e._v("Добавить JIRA")])],1)],1)],1),e._v(" "),r("br"),r("br"),e._v(" "),e.projects?r("div",{staticClass:"md-layout-item md-size-80"},[r("md-list",[r("md-list-item",[e._v("\n          Проекты\n        ")]),e._v(" "),r("md-table",[r("md-table-row",[r("md-table-head"),e._v(" "),r("md-table-head",[e._v("Название")]),e._v(" "),r("md-table-head",[e._v("Url")]),e._v(" "),r("md-table-head",[e._v("Тип")]),e._v(" "),r("md-table-head",[e._v("Авторизация")])],1),e._v(" "),e._l(e.projects,function(t){return r("md-table-row",{key:t.id},[r("md-table-head",[r("div",{on:{click:function(r){e.editProject(t.id)}}},[r("font-awesome-icon",{attrs:{icon:"edit"}})],1)]),e._v(" "),r("md-table-head",[e._v(e._s(t.title))]),e._v(" "),r("md-table-head",[e._v(e._s(t.api_url))]),e._v(" "),r("md-table-head",[e._v(e._s(t.type))]),e._v(" "),r("md-table-head",[e._v(e._s(t.external_api_key))])],1)})],2),e._v(" "),r("md-list-item",[r("md-button",[e._v("Добавить")])],1)],1)],1):e._e()]),e._v(" "),r("br"),e._v(" "),r("div",{staticClass:"md-layout md-gutter md-alignment-top-center center"},[r("div",{staticClass:"md-layout-item md-size-80"},[r("md-list",[r("md-list-item",[r("h3",[e._v("Формат выгрузки часов в evolution")])]),e._v(" "),r("md-list-item",[r("b",[e._v("Есть задача в redmine")]),e._v(" "),r("md-field",[r("label",[e._v("формулировка")]),e._v(" "),r("md-input",{attrs:{required:""},model:{value:e.userSettings.evo_in_name,callback:function(t){e.$set(e.userSettings,"evo_in_name",t)},expression:"userSettings.evo_in_name"}})],1),e._v(" "),r("md-field",[r("label",[e._v("комментарий")]),e._v(" "),r("md-input",{model:{value:e.userSettings.evo_in_comment,callback:function(t){e.$set(e.userSettings,"evo_in_comment",t)},expression:"userSettings.evo_in_comment"}})],1)],1),e._v(" "),r("md-list-item",[r("b",[e._v("Нет задачи в redmine")]),e._v(" "),r("md-field",[r("label",[e._v("формулировка")]),e._v(" "),r("md-input",{attrs:{required:""},model:{value:e.userSettings.evo_out_name,callback:function(t){e.$set(e.userSettings,"evo_out_name",t)},expression:"userSettings.evo_out_name"}})],1),e._v(" "),r("md-field",[r("label",[e._v("комментарий")]),e._v(" "),r("md-input",{model:{value:e.userSettings.evo_out_comment,callback:function(t){e.$set(e.userSettings,"evo_out_comment",t)},expression:"userSettings.evo_out_comment"}})],1)],1),e._v(" "),r("md-list-item",[r("b",[e._v("Допустимые подстановки:")]),r("br"),e._v(" "),r("br"),r("i",[e._v("#redmine_name")]),e._v(" - название задачи из редмайн\n          "),r("br"),r("i",[e._v("#redmine_id")]),e._v(" - номер задачи из редмайн\n          "),r("br"),r("i",[e._v("#name")]),e._v(" - название задачи из трекера\n          "),r("br"),r("i",[e._v("#comments")]),e._v(" - комментарии к задаче из трекера\n        ")]),e._v(" "),r("md-list-item",[r("md-button",{staticClass:"md-accent",on:{click:function(t){e.saveSettings()}}},[e._v("Сохранить")]),e._v(" "),r("md-button",{on:{click:function(t){e.restoreSettings()}}},[e._v("По умолчанию")])],1)],1)],1)]),e._v(" "),r("modal",{attrs:{show:e.showTracker},on:{close:e.closeTrackerModal}},[r("div",{staticClass:"modal-header"}),e._v(" "),r("div",{staticClass:"modal-body"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.currentTracker.id,expression:"currentTracker.id"}],attrs:{type:"hidden",name:"id"},domProps:{value:e.currentTracker.id},on:{input:function(t){t.target.composing||e.$set(e.currentTracker,"id",t.target.value)}}}),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.currentTracker.type,expression:"currentTracker.type"}],attrs:{type:"hidden",name:"type"},domProps:{value:e.currentTracker.type},on:{input:function(t){t.target.composing||e.$set(e.currentTracker,"type",t.target.value)}}}),e._v(" "),r("md-field",[r("label",[e._v("Название")]),e._v(" "),r("md-input",{model:{value:e.currentTracker.title,callback:function(t){e.$set(e.currentTracker,"title",t)},expression:"currentTracker.title"}})],1),e._v(" "),r("md-field",[r("label",[e._v("Url")]),e._v(" "),r("md-input",{model:{value:e.currentTracker.api_url,callback:function(t){e.$set(e.currentTracker,"api_url",t)},expression:"currentTracker.api_url"}})],1)],1),e._v(" "),r("div",{staticClass:"modal-footer text-right"},[r("md-button",{staticClass:"md-primary",on:{click:e.deleteTracker}},[e._v("удалить")]),e._v(" "),r("md-button",{staticClass:"md-primary",on:{click:e.closeTrackerModal}},[e._v("отмена")]),e._v(" "),r("md-button",{staticClass:"md-accent",on:{click:e.saveTracker}},[e._v("сохранить")])],1)]),e._v(" "),r("modal",{attrs:{show:e.showToken},on:{close:e.closeTokenModal}},[r("div",{staticClass:"modal-header"},[r("h2",[e._v("Данные для авторизации в "+e._s(e.currentTracker.title))])]),e._v(" "),r("div",{staticClass:"modal-body"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.currentTracker.id,expression:"currentTracker.id"}],attrs:{type:"hidden",name:"id"},domProps:{value:e.currentTracker.id},on:{input:function(t){t.target.composing||e.$set(e.currentTracker,"id",t.target.value)}}}),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.currentTracker.type,expression:"currentTracker.type"}],attrs:{type:"hidden",name:"type"},domProps:{value:e.currentTracker.type},on:{input:function(t){t.target.composing||e.$set(e.currentTracker,"type",t.target.value)}}}),e._v(" "),r("md-field",[r("label",[e._v("Логин")]),e._v(" "),r("md-input",{model:{value:e.loginToken,callback:function(t){e.loginToken=t},expression:"loginToken"}})],1),e._v(" "),r("md-field",[r("label",[e._v("Пароль")]),e._v(" "),r("md-input",{attrs:{type:"password"},model:{value:e.passwordToken,callback:function(t){e.passwordToken=t},expression:"passwordToken"}})],1)],1),e._v(" "),r("div",{staticClass:"modal-footer text-right"},[r("md-button",{staticClass:"md-primary",on:{click:e.closeTokenModal}},[e._v("отмена")]),e._v(" "),r("md-button",{staticClass:"md-accent",on:{click:e.getToken}},[e._v("отправить")])],1)]),e._v(" "),r("modal",{attrs:{show:e.showUser}},[r("div",{staticClass:"modal-header"},[r("h2",[e._v("Выберите пользователя в "+e._s(e.currentTracker.title))])]),e._v(" "),r("div",{staticClass:"modal-body"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.currentTracker.id,expression:"currentTracker.id"}],attrs:{type:"hidden",name:"id"},domProps:{value:e.currentTracker.id},on:{input:function(t){t.target.composing||e.$set(e.currentTracker,"id",t.target.value)}}}),e._v(" "),r("v-select",{attrs:{options:e.evoUsers},model:{value:e.evoUser,callback:function(t){e.evoUser=t},expression:"evoUser"}})],1),e._v(" "),r("div",{staticClass:"modal-footer text-right"},[r("md-button",{staticClass:"md-primary",on:{click:e.closeUserModal}},[e._v("отмена")]),e._v(" "),r("md-button",{staticClass:"md-accent",on:{click:e.saveEvoUser}},[e._v("сохранить")])],1)]),e._v(" "),r("md-dialog-alert",{attrs:{"md-active":e.showAlert,"md-content":e.alertMessage,"md-confirm-text":"Ок"},on:{"update:mdActive":function(t){e.showAlert=t}}})],1)},staticRenderFns:[]};var s=r("VU/8")(a,o,!1,function(e){r("MewG")},"data-v-54d5f1d5",null);t.default=s.exports}});
//# sourceMappingURL=2.1eb4adc5c91afe7621c1.js.map