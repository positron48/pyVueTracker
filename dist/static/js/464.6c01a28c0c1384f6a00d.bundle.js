"use strict";(self.webpackChunktracker=self.webpackChunktracker||[]).push([[464],{5295:function(e,t,r){var n=r(4991),a=r.n(n),s=r(6314),o=r.n(s)()(a());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]),t.A=o},9464:function(e,t,r){r.r(t),r.d(t,{default:function(){return c}}),r(2762);var n=r(2866),a={data:function(){return{trackers:[],evoUsers:[],evoUser:"",projects:null,loginToken:"",passwordToken:"",currentTracker:{id:0,title:"",api_url:"",type:"redmine"},showTracker:!1,showUser:!1,showToken:!1,showAlert:!1,alertMessage:"",userSettings:{evo_in_name:"#redmine_name",evo_in_comment:"#comments",evo_out_name:"#comments",evo_out_comment:""}}},methods:{getTrackers:function(){var e=this;n.A.getTrackers().then((function(t){e.trackers=t.data.trackers})).catch((function(e){console.log(["getTasks error",e])}))},getEvoUsers:function(){var e=this;n.A.getEvoUsers().then((function(t){e.evoUsers=t.data.users})).catch((function(e){console.log(["getEvoUsers error",e])}))},showTrackerModal:function(){this.showTracker=!0},closeTrackerModal:function(){this.showTracker=!1},deleteTracker:function(e){var t=this;confirm("вы действительно хотите удалить трекер из списка?")&&n.A.deleteTracker(this.currentTracker).then((function(e){t.getTrackers(),t.showTracker=!1})).catch((function(e){console.log(["getToken error",e])}))},saveTracker:function(){var e=this;n.A.saveTracker(this.currentTracker).then((function(t){e.getTrackers(),e.showTracker=!1})).catch((function(e){console.log(["getToken error",e])}))},saveEvoUser:function(){var e=this;n.A.saveEvoUser(this.evoUser).then((function(t){e.getTrackers(),e.showUser=!1})).catch((function(e){console.log(["saveTrackerUser error",e])}))},addTracker:function(e){this.currentTracker={id:0,title:"",api_url:"",type:e},this.showTrackerModal()},editTracker:function(e){this.currentTracker=e,this.showTrackerModal()},getSettings:function(){var e=this;n.A.getSettings().then((function(t){for(var r in t.data.data)e.userSettings[r]=t.data.data[r]})).catch((function(e){console.log(["getSettings error",e])}))},saveSettings:function(){var e=this;if(""===this.userSettings.evo_in_name.trim()||""===this.userSettings.evo_out_name.trim())return this.alert('<span style="color: red;">Формулировка обязательна!</span>'),!1;n.A.saveSettings(this.userSettings).then((function(t){e.alert("Изменения сохранены!")})).catch((function(t){console.log(["saveSettings error",t]),e.alert("Ошибка:"+t)}))},restoreSettings:function(){this.userSettings={evo_in_name:"#redmine_name",evo_in_comment:"#comments",evo_out_name:"#comments",evo_out_comment:""}},showTokenModal:function(e){this.loginToken="",this.passwordToken="",this.currentTracker=e,this.showToken=!0},showUserModal:function(e){"evo"===e.type&&(this.currentTracker=e,this.showUser=!0)},closeTokenModal:function(){this.showToken=!1},closeUserModal:function(){this.showUser=!1},getToken:function(){var e=this;n.A.getToken(this.currentTracker.id,this.loginToken,this.passwordToken).then((function(t){void 0!==t.data.external_token&&null!==t.data.external_token?(e.getTrackers(),"evo"===e.currentTracker.type&&e.getEvoUsers(),e.showToken=!1):e.alert("Ошибка авторизации")})).catch((function(e){console.log(["getToken error",e])}))},alert:function(e){this.alertMessage=e,this.showAlert=!0}},components:{Modal:r(1516).default},mounted:function(){this.getTrackers(),this.getEvoUsers(),this.getSettings()}},s=r(5072),o=r.n(s),i=r(5295),c=(o()(i.A,{insert:"head",singleton:!1}),i.A.locals,(0,r(4486).A)(a,(function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"md-layout md-gutter md-alignment-top-center center"},[t("div",{staticClass:"md-layout-item md-size-80"},[t("md-list",[t("md-list-item",[t("h3",[e._v("Трекеры")])]),e._v(" "),t("md-table",[t("md-table-row",[t("md-table-head"),e._v(" "),t("md-table-head",[e._v("Название")]),e._v(" "),t("md-table-head",[e._v("Url")]),e._v(" "),t("md-table-head",[e._v("Тип")]),e._v(" "),t("md-table-head",[e._v("Авторизация")]),e._v(" "),t("md-table-head",[e._v("Пользователь")])],1),e._v(" "),e._l(e.trackers,(function(r){return t("md-table-row",{key:r.id},[t("md-table-head",[t("div",{staticClass:"edit-icon",on:{click:function(t){return e.editTracker(r)}}},[t("font-awesome-icon",{attrs:{icon:"edit"}}),e._v(" "),t("md-tooltip",{attrs:{"md-direction":"top"}},[e._v("Редактировать")])],1)]),e._v(" "),t("md-table-head",[e._v(e._s(r.title))]),e._v(" "),t("md-table-head",[e._v(e._s(r.api_url))]),e._v(" "),t("md-table-head",[e._v(e._s(r.type))]),e._v(" "),t("md-table-head",[t("a",{staticClass:"simple-link",on:{click:function(t){return e.showTokenModal(r)}}},[t("md-tooltip",{attrs:{"md-direction":"top"}},[e._v("Авторизация на трекере")]),e._v(" "),r.external_api_key?t("span",[e._v(e._s(r.external_api_key))]):e._e(),e._v(" "),r.external_api_key?e._e():t("span",[e._v("Авторизоваться")])],1)]),e._v(" "),t("md-table-head",[r.external_api_key&&"evo"===r.type?t("a",{staticClass:"simple-link",on:{click:function(t){return e.showUserModal(r)}}},[r.external_user_id||"evo"!==r.type?e._e():t("span",[e._v("Указать пользователя")]),e._v(" "),r.external_user_id?t("span",[e._v(e._s(r.external_user_id))]):e._e()]):e._e(),e._v(" "),!r.external_user_id||"redmine"!==r.type&&"jira"!==r.type?e._e():t("span",[e._v(e._s(r.external_user_id))])])],1)}))],2),e._v(" "),t("md-list-item",[t("md-button",{on:{click:function(t){return e.addTracker("redmine")}}},[e._v("Добавить redmine")]),e._v(" "),t("md-button",{on:{click:function(t){return e.addTracker("jira")}}},[e._v("Добавить JIRA")])],1)],1)],1),e._v(" "),t("br"),t("br"),e._v(" "),e.projects?t("div",{staticClass:"md-layout-item md-size-80"},[t("md-list",[t("md-list-item",[e._v("\n          Проекты\n        ")]),e._v(" "),t("md-table",[t("md-table-row",[t("md-table-head"),e._v(" "),t("md-table-head",[e._v("Название")]),e._v(" "),t("md-table-head",[e._v("Url")]),e._v(" "),t("md-table-head",[e._v("Тип")]),e._v(" "),t("md-table-head",[e._v("Авторизация")])],1),e._v(" "),e._l(e.projects,(function(r){return t("md-table-row",{key:r.id},[t("md-table-head",[t("div",{on:{click:function(t){return e.editProject(r.id)}}},[t("font-awesome-icon",{attrs:{icon:"edit"}})],1)]),e._v(" "),t("md-table-head",[e._v(e._s(r.title))]),e._v(" "),t("md-table-head",[e._v(e._s(r.api_url))]),e._v(" "),t("md-table-head",[e._v(e._s(r.type))]),e._v(" "),t("md-table-head",[e._v(e._s(r.external_api_key))])],1)}))],2),e._v(" "),t("md-list-item",[t("md-button",[e._v("Добавить")])],1)],1)],1):e._e()]),e._v(" "),t("br"),e._v(" "),t("div",{staticClass:"md-layout md-gutter md-alignment-top-center center"},[t("div",{staticClass:"md-layout-item md-size-80"},[t("md-list",[t("md-list-item",[t("h3",[e._v("Формат выгрузки часов в evolution")])]),e._v(" "),t("md-list-item",[t("b",[e._v("Есть задача в redmine")]),e._v(" "),t("md-field",[t("label",[e._v("формулировка")]),e._v(" "),t("md-input",{attrs:{required:""},model:{value:e.userSettings.evo_in_name,callback:function(t){e.$set(e.userSettings,"evo_in_name",t)},expression:"userSettings.evo_in_name"}})],1),e._v(" "),t("md-field",[t("label",[e._v("комментарий")]),e._v(" "),t("md-input",{model:{value:e.userSettings.evo_in_comment,callback:function(t){e.$set(e.userSettings,"evo_in_comment",t)},expression:"userSettings.evo_in_comment"}})],1)],1),e._v(" "),t("md-list-item",[t("b",[e._v("Нет задачи в redmine")]),e._v(" "),t("md-field",[t("label",[e._v("формулировка")]),e._v(" "),t("md-input",{attrs:{required:""},model:{value:e.userSettings.evo_out_name,callback:function(t){e.$set(e.userSettings,"evo_out_name",t)},expression:"userSettings.evo_out_name"}})],1),e._v(" "),t("md-field",[t("label",[e._v("комментарий")]),e._v(" "),t("md-input",{model:{value:e.userSettings.evo_out_comment,callback:function(t){e.$set(e.userSettings,"evo_out_comment",t)},expression:"userSettings.evo_out_comment"}})],1)],1),e._v(" "),t("md-list-item",[t("b",[e._v("Допустимые подстановки:")]),t("br"),e._v(" "),t("br"),t("i",[e._v("#redmine_name")]),e._v(" - название задачи из редмайн\n          "),t("br"),t("i",[e._v("#redmine_id")]),e._v(" - номер задачи из редмайн\n          "),t("br"),t("i",[e._v("#name")]),e._v(" - название задачи из трекера\n          "),t("br"),t("i",[e._v("#comments")]),e._v(" - комментарии к задаче из трекера\n        ")]),e._v(" "),t("md-list-item",[t("md-button",{staticClass:"md-accent",on:{click:function(t){return e.saveSettings()}}},[e._v("Сохранить")]),e._v(" "),t("md-button",{on:{click:function(t){return e.restoreSettings()}}},[e._v("По умолчанию")])],1)],1)],1)]),e._v(" "),t("modal",{attrs:{show:e.showTracker},on:{close:e.closeTrackerModal}},[t("div",{staticClass:"modal-header"}),e._v(" "),t("div",{staticClass:"modal-body"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentTracker.id,expression:"currentTracker.id"}],attrs:{type:"hidden",name:"id"},domProps:{value:e.currentTracker.id},on:{input:function(t){t.target.composing||e.$set(e.currentTracker,"id",t.target.value)}}}),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentTracker.type,expression:"currentTracker.type"}],attrs:{type:"hidden",name:"type"},domProps:{value:e.currentTracker.type},on:{input:function(t){t.target.composing||e.$set(e.currentTracker,"type",t.target.value)}}}),e._v(" "),t("md-field",[t("label",[e._v("Название")]),e._v(" "),t("md-input",{model:{value:e.currentTracker.title,callback:function(t){e.$set(e.currentTracker,"title",t)},expression:"currentTracker.title"}})],1),e._v(" "),t("md-field",[t("label",[e._v("Url")]),e._v(" "),t("md-input",{model:{value:e.currentTracker.api_url,callback:function(t){e.$set(e.currentTracker,"api_url",t)},expression:"currentTracker.api_url"}})],1)],1),e._v(" "),t("div",{staticClass:"modal-footer text-right"},[t("md-button",{staticClass:"md-primary",on:{click:e.deleteTracker}},[e._v("удалить")]),e._v(" "),t("md-button",{staticClass:"md-primary",on:{click:e.closeTrackerModal}},[e._v("отмена")]),e._v(" "),t("md-button",{staticClass:"md-accent",on:{click:e.saveTracker}},[e._v("сохранить")])],1)]),e._v(" "),t("modal",{attrs:{show:e.showToken},on:{close:e.closeTokenModal}},[t("div",{staticClass:"modal-header"},[t("h2",[e._v("Данные для авторизации в "+e._s(e.currentTracker.title))])]),e._v(" "),t("div",{staticClass:"modal-body"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentTracker.id,expression:"currentTracker.id"}],attrs:{type:"hidden",name:"id"},domProps:{value:e.currentTracker.id},on:{input:function(t){t.target.composing||e.$set(e.currentTracker,"id",t.target.value)}}}),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentTracker.type,expression:"currentTracker.type"}],attrs:{type:"hidden",name:"type"},domProps:{value:e.currentTracker.type},on:{input:function(t){t.target.composing||e.$set(e.currentTracker,"type",t.target.value)}}}),e._v(" "),t("md-field",[t("label",[e._v("Логин")]),e._v(" "),t("md-input",{model:{value:e.loginToken,callback:function(t){e.loginToken=t},expression:"loginToken"}})],1),e._v(" "),t("md-field",[t("label",[e._v("Пароль")]),e._v(" "),t("md-input",{attrs:{type:"password"},model:{value:e.passwordToken,callback:function(t){e.passwordToken=t},expression:"passwordToken"}})],1)],1),e._v(" "),t("div",{staticClass:"modal-footer text-right"},[t("md-button",{staticClass:"md-primary",on:{click:e.closeTokenModal}},[e._v("отмена")]),e._v(" "),t("md-button",{staticClass:"md-accent",on:{click:e.getToken}},[e._v("отправить")])],1)]),e._v(" "),t("modal",{attrs:{show:e.showUser}},[t("div",{staticClass:"modal-header"},[t("h2",[e._v("Выберите пользователя в "+e._s(e.currentTracker.title))])]),e._v(" "),t("div",{staticClass:"modal-body"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentTracker.id,expression:"currentTracker.id"}],attrs:{type:"hidden",name:"id"},domProps:{value:e.currentTracker.id},on:{input:function(t){t.target.composing||e.$set(e.currentTracker,"id",t.target.value)}}}),e._v(" "),t("v-select",{attrs:{options:e.evoUsers},model:{value:e.evoUser,callback:function(t){e.evoUser=t},expression:"evoUser"}})],1),e._v(" "),t("div",{staticClass:"modal-footer text-right"},[t("md-button",{staticClass:"md-primary",on:{click:e.closeUserModal}},[e._v("отмена")]),e._v(" "),t("md-button",{staticClass:"md-accent",on:{click:e.saveEvoUser}},[e._v("сохранить")])],1)]),e._v(" "),t("md-dialog-alert",{attrs:{"md-active":e.showAlert,"md-content":e.alertMessage,"md-confirm-text":"Ок"},on:{"update:mdActive":function(t){e.showAlert=t},"update:md-active":function(t){e.showAlert=t}}})],1)}),[],!1,null,"54d5f1d5",null).exports)}}]);